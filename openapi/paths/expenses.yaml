/api/expenses:
  get:
    tags:
      - expenses
    summary: 家計簿データ一覧取得（ページネーション対応）
    parameters:
      - name: month
        in: query
        required: true
        description: データ取得する月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
      - name: page
        in: query
        required: false
        description: ページ番号（0始まり）。省略時は0
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: size
        in: query
        required: false
        description: 1ページあたりの件数。省略時は10、最大50
        schema:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
    responses:
      '200':
        description: 家計簿データ一覧取得成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ExpensePageDto'
      '400':
        description: バリデーションエラー（month形式不正、page/size範囲外など）
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
  post:
    tags:
      - expenses
    summary: 家計簿データ追加
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/expense.yaml#/ExpenseRequestDto'
    responses:
      '201':
        description: 家計簿データ追加成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ExpenseDto'
/api/expenses/{id}:
  delete:
    tags:
      - expenses
    summary: 家計簿データ削除
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    responses:
      '204':
        description: 家計簿データ削除成功
      '404':
        description: 家計簿データが見つからない
  put:
    tags:
      - expenses
    summary: 家計簿データ更新
    description: 指定されたIDの家計簿データを更新します
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/expense.yaml#/ExpenseRequestDto'
    responses:
      '200':
        description: 家計簿データ更新成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ExpenseDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
      '404':
        description: 家計簿データが見つからない
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/summary:
  get:
    tags:
      - expenses
    summary: 月別サマリー取得
    parameters:
      - name: month
        in: query
        required: true
        description: 対象月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
    responses:
      '200':
        description: 月別サマリー取得成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/MonthlySummaryDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/summary/range:
  get:
    tags:
      - expenses
    summary: 範囲指定で月別サマリー取得
    parameters:
      - name: startMonth
        in: query
        required: true
        description: 開始月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
      - name: endMonth
        in: query
        required: true
        description: 終了月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-06'
    responses:
      '200':
        description: 範囲指定で月別サマリー取得成功
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas/expense.yaml#/MonthlySummaryDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/months:
  get:
    tags:
      - expenses
    summary: 利用可能な月のリスト取得
    responses:
      '200':
        description: 利用可能な月のリスト取得成功 (YYYY-MM形式)
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                pattern: '^\d{4}-\d{2}$'
                example: '2024-01'
/api/expenses/report:
  get:
    tags:
      - expenses
    summary: 月次AIレポート取得
    description: 指定された月の支出データを分析し、AIが生成した改善提案を含むレポートを返します。generate=falseのときはキャッシュのみ返し、キャッシュがなければ204を返します（OpenAIを呼び出しません）。generate=trueのときはキャッシュを無視して新規生成します。
    parameters:
      - name: month
        in: query
        required: true
        description: 対象月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
      - name: generate
        in: query
        required: false
        description: trueの場合、キャッシュを無視して新規にAIレポートを生成します。falseの場合はキャッシュがあれば返し、なければ204を返します。
        schema:
          type: boolean
          default: false
    responses:
      '200':
        description: 月次レポート取得成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/MonthlyReportResponse'
      '204':
        description: キャッシュが存在しない（generate=falseの場合のみ）
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
      '500':
        description: AIサービスエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/upload-csv:
  post:
    tags:
      - expenses
    summary: CSVファイルから家計簿データを一括インポート
    description: CSVファイルをアップロードして、複数の家計簿データを一括で追加します。部分成功をサポートし、エラーが発生した行の詳細を返します。
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - file
              - csvFormat
            properties:
              file:
                type: string
                format: binary
                description: CSVファイル（UTF-8エンコーディング）
              csvFormat:
                type: string
                enum:
                  - MITSUISUMITOMO_OLD_FORMAT
                  - MITSUISUMITOMO_NEW_FORMAT
                description: "CSV形式（MITSUISUMITOMO_OLD_FORMAT: 三井住友カード 2025/12以前、MITSUISUMITOMO_NEW_FORMAT: 三井住友カード 2026/1以降）"
                example: MITSUISUMITOMO_OLD_FORMAT
    responses:
      '200':
        description: CSVインポート成功（部分成功も含む）
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/CsvUploadResponseDto'
      '400':
        description: バリデーションエラー（ファイルが空、形式が不正など）
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
      '413':
        description: ファイルサイズが大きすぎる
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'