/api/expenses:
  get:
    tags:
      - expenses
    summary: 家計簿データ一覧取得
    parameters:
      - name: month
        in: query
        required: false
        description: データ取得する月を指定する。指定しない場合は全データを取得
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
    responses:
      '200':
        description: 家計簿データ一覧取得成功
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas/expense.yaml#/ExpenseDto'
  post:
    tags:
      - expenses
    summary: 家計簿データ追加
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/expense.yaml#/ExpenseRequestDto'
    responses:
      '201':
        description: 家計簿データ追加成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ExpenseDto'
/api/expenses/{id}:
  delete:
    tags:
      - expenses
    summary: 家計簿データ削除
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    responses:
      '204':
        description: 家計簿データ削除成功
      '404':
        description: 家計簿データが見つからない
  put:
    tags:
      - expenses
    summary: 家計簿データ更新
    description: 指定されたIDの家計簿データを更新します
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/expense.yaml#/ExpenseRequestDto'
    responses:
      '200':
        description: 家計簿データ更新成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ExpenseDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
      '404':
        description: 家計簿データが見つからない
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/summary:
  get:
    tags:
      - expenses
    summary: 月別サマリー取得
    parameters:
      - name: month
        in: query
        required: true
        description: 対象月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
    responses:
      '200':
        description: 月別サマリー取得成功
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/MonthlySummaryDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/summary/range:
  get:
    tags:
      - expenses
    summary: 範囲指定で月別サマリー取得
    parameters:
      - name: startMonth
        in: query
        required: true
        description: 開始月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-01'
      - name: endMonth
        in: query
        required: true
        description: 終了月（YYYY-MM形式）
        schema:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: '2024-06'
    responses:
      '200':
        description: 範囲指定で月別サマリー取得成功
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas/expense.yaml#/MonthlySummaryDto'
      '400':
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
/api/expenses/months:
  get:
    tags:
      - expenses
    summary: 利用可能な月のリスト取得
    responses:
      '200':
        description: 利用可能な月のリスト取得成功
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                pattern: '^\d{4}-\d{2}$'
                example: '2024-01'
/api/expenses/upload-csv:
  post:
    tags:
      - expenses
    summary: CSVファイルから家計簿データを一括インポート
    description: CSVファイルをアップロードして、複数の家計簿データを一括で追加します。部分成功をサポートし、エラーが発生した行の詳細を返します。
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - file
              - csvFormat
            properties:
              file:
                type: string
                format: binary
                description: CSVファイル（UTF-8エンコーディング）
              csvFormat:
                type: string
                enum:
                  - MITSUISUMITOMO_OLD_FORMAT
                  - MITSUISUMITOMO_NEW_FORMAT
                description: "CSV形式（MITSUISUMITOMO_OLD_FORMAT: 三井住友カード 2025/12以前、MITSUISUMITOMO_NEW_FORMAT: 三井住友カード 2026/1以降）"
                example: MITSUISUMITOMO_OLD_FORMAT
    responses:
      '200':
        description: CSVインポート成功（部分成功も含む）
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/CsvUploadResponseDto'
      '400':
        description: バリデーションエラー（ファイルが空、形式が不正など）
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'
      '413':
        description: ファイルサイズが大きすぎる
        content:
          application/json:
            schema:
              $ref: '../components/schemas/expense.yaml#/ErrorResponse'